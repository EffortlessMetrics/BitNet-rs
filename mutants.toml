# Mutation testing configuration for bitnet-rs
#
# This file configures cargo-mutants to exclude files that cannot be effectively
# tested through mutation testing due to tooling limitations or architectural constraints.
#
# See Issue #440 for mutation testing hardening strategy.

# Files and directories excluded from mutation testing
exclude_globs = [
    # Build scripts - tooling glue that runs at compile time with no runtime test harness
    "**/build.rs",

    # FFI shim modules - thin wrappers around C++ code where:
    # 1. The real logic lives in C++ (not Rust)
    # 2. Mutations would break FFI ABI contracts
    # 3. Cross-language testing is complex and outside mutation test scope
    "**/ffi/**/*.rs",
    "**/*_ffi.rs",
    "**/sys/**/*.rs",

    # Build artifacts
    "target/**",

    # Generated bindings and code
    "**/bindings.rs",
    "**/generated/**",

    # Vendored code
    "vendor/**",

    # Test utilities and fixtures (not production code)
    "**/tests/common/**",
    "**/tests/fixtures/**",
    "**/test_utilities.rs",

    # Benchmark code (separate from production logic)
    "**/benches/**",

    # Embedded OpenCL kernel source strings (not Rust logic; mutations
    # would produce invalid GPU programs that only fail at runtime on real
    # hardware, not in unit tests)
    "**/gpu/kernels/*.cl",
]

# ── OpenCL / oneAPI mutation scope ──────────────────────────────────────────
#
# Focus mutation testing on the Rust orchestration logic around OpenCL,
# not the embedded kernel source strings.  Use `examine_re` to include
# only functions in the opencl module and `exclude_re` to skip
# auto-generated trait boilerplate that mutants can't meaningfully test.

# Functions to mutate (regex matches on the fully-qualified function name).
# cargo-mutants examines every function by default; these patterns *restrict*
# the set when passed via --examine-re on the CLI (see scripts/mutant_opencl.sh).
examine_re = [
    # OpenCL provider module — core orchestration
    "opencl::OpenClKernel::.*",
    # Device feature detection helpers
    "device_features::.*",
    # Kernel registry backend selection
    "kernel_registry::KernelCapabilities::.*",
    "kernel_registry::KernelBackend::.*",
    # Device probe oneAPI functions
    "bitnet_device_probe::oneapi_.*",
    "bitnet_device_probe::probe_gpu",
    "bitnet_device_probe::fake_gpu_backends",
]

# Functions/items to skip even if they match examine_re.
exclude_re = [
    # Debug / Display trait impls — cosmetic, not logic
    "fmt$",
    # Auto-derived Clone/PartialEq
    "clone$",
    "eq$",
    # Unsafe Send/Sync marker impls (no body to mutate)
    "Send|Sync",
]

# Mutation testing thresholds and timeouts
#
# Note: Some crates like bitnet-kernels may have lower mutation scores due to
# compile-time feature gate testing limitations (see device_features.rs comments).
# This is acceptable as long as runtime behavior is thoroughly tested.

# Increase timeout for GPU tests and complex inference workloads
# Default is 300s, but neural network operations can take longer
timeout = 600

# Minimum acceptable mutation score for logic-heavy crates
# Excludes thin FFI wrappers and build scripts
minimum_test_timeout = 20
