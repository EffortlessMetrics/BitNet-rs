================================================================================
TEST FILTERING INVESTIGATION SUMMARY
================================================================================

Question: Why are 94% of tests (1,883 out of 2,005) filtered out?

Answer: The workspace structure, not individual cfg gates, is the primary cause.

================================================================================
KEY FINDINGS
================================================================================

1. THE PRIMARY ISSUE: tests/Cargo.toml uses autotests = false
   ─────────────────────────────────────────────────────────
   - ~1,750+ test files exist in tests/ directory
   - autotests = false means they are NEVER auto-discovered
   - Only 6 test binaries are explicitly registered via [[test]] sections
   - Impact: ~87% of total tests are never compiled or run
   
   Location: /tests/Cargo.toml:8
   Current:  autotests = false
   
   This single setting is responsible for filtering out ~1,750 tests!

2. FEATURE-GATED TESTS: Properly gated (51 tests, by design)
   ───────────────────────────────────────────────────────
   These are NOT a problem - they're features that aren't enabled:
   
   - gpu                    (12 tests) - requires CUDA
   - opentelemetry          (12 tests) - requires metrics deps
   - full-engine            (8 tests)  - optional engine feature
   - cpu                    (10 tests) - already enabled in command
   - Architecture-specific  (2-3 tests) - x86_64/aarch64/wasm32
   - ffi, simd, iq2s-ffi    (5 tests) - optional FFI features

3. TDD SCAFFOLDING: Module-level disabled (7 tests)
   ──────────────────────────────────────────────
   File: crates/bitnet-tokenizers/tests/universal_tokenizer_integration.rs
   Pattern: #![cfg(false)]
   Status: Intentional MVP scaffold - can be enabled later

4. TEST FILES WITH ALL TESTS GATED: 18 files, ~80 tests
   ────────────────────────────────────────────────────
   Example issues:
   
   a) CPU-feature tests that should run but don't show tests:
      - test_ac1_embedded_tokenizer_support.rs (10 tests, #[cfg(feature = "cpu")])
      - test_ac2_model_architecture_detection.rs (16 tests, #[cfg(feature = "cpu")])
      - test_ac3_vocabulary_size_resolution.rs (16 tests, #[cfg(feature = "cpu")])
      - test_ac5_production_readiness.rs (15 tests, #[cfg(feature = "cpu")])
      
      These show 0 tests despite --features cpu being enabled.
      This suggests a parsing/gate application issue.

================================================================================
QUICK FIXES (Priority Order)
================================================================================

PRIORITY 1 (High Impact):
─────────────────────────
Fix: tests/Cargo.toml
Action: Remove autotests = false

  Before:
    [package]
    autotests = false

  After:
    [package]
    # autotests enabled by default - uncomment if need to disable
    # autotests = false

Expected impact: +1,750 tests visible

PRIORITY 2 (Cleanup):
────────────────────
Fix: Investigate why CPU-feature tests show 0
Location: crates/bitnet-tokenizers/tests/test_ac*.rs

Current:
  #[cfg(feature = "cpu")]
  #[test]
  fn test_something() { ... }

Investigation: Verify the cfg pattern is being recognized correctly

PRIORITY 3 (TDD Conversion):
───────────────────────────
Fix: Replace #![cfg(false)] with #[ignore] pattern
Location: crates/bitnet-tokenizers/tests/universal_tokenizer_integration.rs

Before:
  #![cfg(false)]
  
  #[test]
  fn test_foo() { unimplemented!() }

After:
  #[test]
  #[ignore = "TDD scaffold - Issue #XXX"]
  fn test_foo() { unimplemented!() }

This makes the intention clearer and allows selective running.

================================================================================
COMMANDS TO RUN ALL TESTS
================================================================================

Current (produces ~250 tests):
  cargo test --workspace --no-default-features --features cpu --lib --tests

After Priority 1 fix (produces ~2,000+ tests):
  cargo test --workspace --no-default-features --features cpu --lib --tests

With all optional features (produces ~600-800 tests, subset):
  cargo test --workspace --no-default-features \
    --features cpu,gpu,inference,ffi,full-engine,opentelemetry,simd,iq2s-ffi,crossval \
    --lib --tests

================================================================================
FEATURE REQUIREMENTS FOR DIFFERENT TEST SETS
================================================================================

CPU-Only (baseline):
  cargo test --workspace --no-default-features --features cpu --lib --tests
  Current: ~250 tests
  After fix: ~2,000 tests

GPU Tests (+12 tests):
  cargo test --workspace --no-default-features --features cpu,gpu --lib --tests

Observability Tests (+12 tests):
  cargo test --workspace --no-default-features --features cpu,opentelemetry --lib --tests

Full Suite (with infrastructure available):
  cargo test --workspace --no-default-features \
    --features cpu,gpu,inference,ffi,full-engine,opentelemetry,simd,iq2s-ffi,crossval \
    --lib --tests

================================================================================
DETAILED CFG PATTERN ANALYSIS
================================================================================

Module-Level Gates:
  - #![cfg(false)]         → 7 tests (1 file, intentional scaffolding)
  
Feature Gates (individual tests):
  - #[cfg(feature = "gpu")]          → 12 tests (OK - requires CUDA)
  - #[cfg(feature = "inference")]    → 20+ tests (OK - optional)
  - #[cfg(feature = "opentelemetry")] → 12 tests (OK - optional)
  - #[cfg(feature = "cpu")]          → 10 tests (should already run!)
  - #[cfg(feature = "ffi")]          → 2 tests (OK - optional)
  - Others                           → 10+ tests

Architecture Gates:
  - #[cfg(target_arch = "x86_64")]   → 1 test
  - #[cfg(target_arch = "aarch64")]  → 1 test
  - #[cfg(target_arch = "wasm32")]   → 2 tests

Complex Gates (combinations):
  - #[cfg(all(feature = "gpu", not(feature = "strict")))]
  - #[cfg(any(feature = "gpu", feature = "cuda"))]
  - Multiple nested conditions

================================================================================
INVESTIGATION CHECKLIST
================================================================================

[ ] Verify tests/Cargo.toml has autotests = false (CONFIRMED)
[ ] Check if removing autotests = false resolves ~1,750 missing tests
[ ] Investigate why CPU-feature tests don't show any tests
[ ] Determine if complex cfg patterns are being parsed correctly
[ ] Verify feature gates are actually working (spot check 2-3 files)
[ ] Test with different feature combinations
[ ] Document findings in CLAUDE.md

================================================================================
CONCLUSION
================================================================================

The 94% filtering is NOT a code quality issue. Instead:

1. ~87% is due to autotests = false in tests/Cargo.toml (structural)
2. ~7% is feature-gated tests (by design, not an issue)
3. ~1% is TDD scaffolding (intentional MVP pattern)

ACTION: Remove autotests = false from tests/Cargo.toml to unlock ~1,750 tests.

This is a configuration issue, not a testing strategy problem.
================================================================================
