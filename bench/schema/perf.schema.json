{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "BitNet Performance Measurement Schema",
  "description": "Schema for performance measurement JSON outputs",
  "type": "object",
  "required": [
    "schema_version",
    "platform",
    "wsl2",
    "date",
    "git_commit",
    "model_id",
    "iterations",
    "bitnet_rs",
    "improvement",
    "environment"
  ],
  "properties": {
    "schema_version": {
      "type": "integer",
      "const": 1,
      "description": "Schema version number"
    },
    "platform": {
      "type": "string",
      "pattern": "^[a-z]+-[a-z0-9_]+(-WSL2)?$",
      "description": "Platform identifier (e.g., linux-x86_64-WSL2)"
    },
    "wsl2": {
      "type": "boolean",
      "description": "Whether running under WSL2"
    },
    "date": {
      "type": "string",
      "format": "date-time",
      "description": "Measurement date in ISO 8601 format (e.g., YYYY-MM-DDTHH:MM:SSZ)"
    },
    "git_commit": {
      "type": "string",
      "description": "Git commit hash (short form)"
    },
    "git_dirty": {
      "type": "boolean",
      "description": "Whether working tree has uncommitted changes"
    },
    "model_hash": {
      "type": "string",
      "description": "First 16 chars of model file SHA256"
    },
    "model_id": {
      "type": "string",
      "description": "Model identifier"
    },
    "cli_args": {
      "type": "string",
      "description": "Command line arguments used"
    },
    "iterations": {
      "type": "integer",
      "minimum": 1,
      "description": "Number of benchmark iterations"
    },
    "warmup": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of warmup iterations"
    },
    "threads": {
      "type": "integer",
      "minimum": 1,
      "description": "Number of CPU threads used"
    },
    "bitnet_rs": {
      "type": "object",
      "properties": {
        "tps_mean": { "type": "number" },
        "tps_std": { "type": "number" },
        "tps_median": { "type": "number" },
        "ft_ms_mean": { "type": "number" },
        "ft_ms_std": { "type": "number" },
        "ft_ms_median": { "type": "number" },
        "rss_kb": { "type": "integer" },
        "rss_mb": { "type": "integer" },
        "rss_kb_median": { "type": "integer" },
        "load_ms": { "type": "integer" },
        "load_s": { "type": "number" },
        "load_s_median": { "type": "number" }
      }
    },
    "bitnet_rs_format": {
      "type": "string",
      "enum": ["safetensors", "gguf"],
      "description": "Format used for bitnet_rs measurements"
    },
    "bitnet_cpp": {
      "type": "object",
      "description": "Baseline measurements (optional)"
    },
    "bitnet_cpp_format": {
      "type": "string",
      "enum": ["safetensors", "gguf", "none"],
      "description": "Format used for baseline measurements"
    },
    "improvement": {
      "type": "object",
      "required": ["throughput_pct", "latency_pct", "memory_pct", "load_time_pct"],
      "properties": {
        "throughput_pct": { "type": "number" },
        "latency_pct": { "type": "number" },
        "memory_pct": { "type": "number" },
        "load_time_pct": { "type": "number" }
      }
    },
    "environment": {
      "type": "object",
      "required": ["deterministic", "seed", "cpu_count"],
      "properties": {
        "deterministic": { "type": "boolean" },
        "seed": { "type": "integer" },
        "cpu_count": { "type": "integer" },
        "bitnet_bin": { "type": "string" }
      }
    }
  }
}