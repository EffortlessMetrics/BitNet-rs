[package]
description = "Comprehensive testing framework for BitNet.rs"
edition = "2024"
name = "bitnet-tests"
version = "0.1.0"

[lib]
name = "bitnet_tests"
path = "lib.rs"

[features]
# Keep integration OFF by default to unblock builds/tests focused on crossval
default = ["reporting", "fixtures", "trend"]
full-framework = ["reporting", "fixtures", "trend"]
reporting = []
fixtures = []
trend = []
crossval = []
# New: gate the integration suite
integration-tests = []

[[bin]]
name = "validate_config"
path = "bin/validate_config.rs"
required-features = ["fixtures"]

[[bin]]
name = "run_configuration_tests"
path = "run_configuration_tests.rs"
required-features = ["fixtures"]

[[bin]]
name = "generate_ci_report"
path = "bin/generate_ci_report.rs"
required-features = ["reporting"]

[[bin]]
name = "check_performance_regressions"
path = "bin/check_performance_regressions.rs"
required-features = ["fixtures"]

[[bin]]
name = "generate_trend_analysis"
path = "bin/generate_trend_analysis.rs"
required-features = ["trend", "reporting"]

[[bin]]
name = "ci_status_integration"
path = "bin/ci_status_integration.rs"
required-features = ["reporting", "fixtures"]

[[bin]]
name = "demo_reporting_comprehensive"
path = "demo_reporting_comprehensive.rs"
required-features = ["reporting"]


[[bin]]
name = "demo_error_handling"
path = "demo_error_handling.rs"

[[bin]]
name = "demo_reporting_system"
path = "demo_reporting_system.rs"
required-features = ["reporting"]

[[bin]]
name = "fast_feedback_simple_demo"
path = "bin/fast_feedback_simple_demo.rs"
required-features = ["fixtures"]

[[test]]
name = "test_logging_infrastructure"
path = "test_logging_infrastructure.rs"

[[test]]
name = "test_bitnet_implementation"
path = "test_bitnet_implementation.rs"

[[test]]
name = "test_reporting_minimal"
path = "test_reporting_minimal.rs"

[[test]]
name = "test_ci_reporting_simple"
path = "test_ci_reporting_simple.rs"

[[example]]
name = "reporting_example"
path = "examples/reporting_example.rs"

[dependencies]
# Async runtime and utilities
async-trait = "0.1"
futures-util = "0.3"
tokio = { version = "1.0", features = ["full"] }

# System information
num_cpus = "1.16"

# Serialization and configuration
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_yaml = "0.9"
toml = "0.8"

# HTTP client for fixture downloads
reqwest = { version = "0.12", features = ["json", "stream"] }

# Cryptography for checksums
digest = "0.10"
sha2 = { version = "0.10", features = ["std"] }

# Error handling
anyhow = "1.0"
thiserror = "2.0"

# Logging and tracing
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }

# System utilities
regex = "1.0"
walkdir = "2.0"

# Testing utilities
env_logger = "0.10"
tempfile = "3.0"

# Random number generation
fastrand = "2.0"
rand = "0.8"

# Date and time utilities
chrono = { version = "0.4", features = ["serde"] }

# Command line argument parsing
clap = { version = "4.0", features = ["derive"] }

# HTML escaping for reports
html-escape = "0.2"

# XML generation for JUnit reports
xml-rs = "0.8"

# System interface for all platforms
libc = "0.2"

# Compression for cache
flate2 = "1.0"

# Coverage reporting
cargo_metadata = "0.18"

# File timestamp manipulation
filetime = "0.2"

# BitNet.rs crates for cross-validation
bitnet-common = { path = "../crates/bitnet-common" }
bitnet-inference = { path = "../crates/bitnet-inference", default-features = false, features = ["cpu", "rt-tokio"] }
bitnet-models = { path = "../crates/bitnet-models" }
bitnet-tokenizers = { path = "../crates/bitnet-tokenizers" }
bitnet-compat = { path = "../crates/bitnet-compat" }
bitnet = { path = "../", default-features = false, features = ["cpu"] }

# Platform-specific dependencies
[target.'cfg(target_os = "windows")'.dependencies]
winapi = { version = "0.3", features = ["processthreadsapi", "psapi", "fileapi", "minwindef"] }

[dev-dependencies]
# Test helper dependencies
fastrand = "2"
filetime = "0.2"
html-escape = "0.2"
serde = { version = "1", features = ["derive"] }
libc = "0.2"
